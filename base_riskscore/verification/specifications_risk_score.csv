Steps in algorithm,Definition,Parameters,Value/Derivation,Details
Prep to run CV-Superlearner,,,,
Input dataset,dat.mock dataset in COVIDcorr data package,,,
Baseline demographic risk variables considered for risk score development (input),"MinorityInd, EthnicityHispanic, EthnicityNotreported, EthnicityUnknown, Black, Asian, NatAmer, PacIsl, WhiteNonHispanic, Multiracial, Other, Notreported, Unknown, HighRiskInd, Sex, Age, BMI",,,
Endpoint  (input),EventIndPrimaryD57,,,
Create the phase 1 dataset (ph1_placebo),"All ptids in the placebo arm AND as ""per protocol"". Drop records with missing values for Ptid, Trt, and endpoint columns.",,,
Identify   np,Total cases (defined by endpoint) in phase 1 dataset,,,
Identify   maxVar,The maximum number of variables that will be allowed by SL screens in the models,,Maximum of 20  OR  floor value of np/20,
"Drop risk variables that fail checks. Also, impute missing values.",,,"1) Remove risk variables that have more than 5% missing values. 2) Remove any binary risk variables with fewer than 10 ptids that have a 1 or a 0 for that variable. 3) If any risk variable has a constant value (0 or 1) with NA's, assign the constant value to all observations.  4) For  risk variables that are not constant, conduct imputations using mice function with m = 1 and seed= 1.",
"Scale all risk variables to have mean 0, sd 1 ",,,,
,,,,
Input to CV-SuperLearner run on placebo arm data (CV-SL fit),,,"For reproducibility of CV-Superlearner results,  use seed ""20210216""; use results from only 1 random CV-SL run.",
,,Y,outcome as vector derived from phase 1 dataset (ph1_placebo),
,,X ,risk variables that have been scaled as data frame ,
,,family ,binomial,
,,obsWeights,All observations have equal weighting of 1 as this is phase 1 data,
,,SL.library,SL library created as below based off combination of learners and screens,
,,method ,method.CC_nloglik,
,,cvControl,"list of 2 where first is V = V_outer, and other is stratifyCV which is TRUE",V_outer is outer validation fold equal to 5. 
,,innerCvControl,list of list containing V = total folds for inner validation,"if  np is less or equal to 30, then perform Leave-One-Out inner validation. Otherwise, perform 5-fold inner validation"
,,vimp,FALSE,This is not used as parameter in the CV-SL call but could be used in post-processing if TRUE. 
,,LEARNERS,,
,,:DEMO run,"SL.mean, SL.glm                                                                             ",
,,:PROD run,"SL.mean,  SL.glm, SL.glm.interaction, SL.glmnet, SL.gam, SL.xgboost, SL.ranger",
,,SCREENS,"In all 4 screens, if total variables passing the screen > maxVar, then the variables are ranked by significance determined from a logistic regression of each variable with endpoint as outcome, and the most significant variables are selected in the model. ",
,,1) screen_all ,"No screen. This screen is run only with non-data-adaptive learners, namely, SL.mean, SL.glm, SL.glmnet, SL.xgboost, SL.ranger",
,,2) screen_glmnet                                                                  ,"alpha = 1, minscreen = 2, nfolds = 10, nlambda = 100",
,,3) screen_univariate_logistic_pval   ,"minPvalue = 0.1, minscreen = 2;    If number of variables with p-value less than minPvalue is less than minscreen, then issue warning and select the two variables with lowest minimum pvalue.",
,,4) screen_highcor_random  ,"if any two variables have Spearman correlation > 0.9, then choose any one of them at random ",
,,,,
Derive CV-AUCs using measure_auc function in vimp package (Refer note at bottom),,fit,CV-SL fit,
,,scale ,identity,
,,,,
Validate CV-AUCs and 95% CIs for each Learner-Screen combination!,,,,
,,,,
Run Superlearner on placebo arm data (SL_fit),,Y,outcome as vector,
,,X ,risk variables as data frame,
,,family ,binomial,
,,SL.library,SL library created by sl_screens.R,
,,method ,method.CC_nloglik,
,,,,
Prepare vaccine arm data to perform predictions,,,,
Input dataset,Same as above ,,,
Baseline demographic variables considered for risk score development (input),Same as above ,,1) Remove risk variables that have more than 5% missing values. 2) Remove any binary risk variables with fewer than 10 ptids that have a 1 or a 0 for that variable.,
Endpoint  (input),Same as above ,,,
Create the phase 1 dataset (ph1_vaccine),"All ptids in the vaccine arm AND as ""per protocol"". Drop records with missing values for Ptid, Trt, and endpoint columns.",,,
Identify   maxVar,Same as above (this variable is derived using placebo arm data),,,
Conduct imputations on missing values in risk variables using mice package,,,"Use n.imp = 10, use seed ""20210216"",  and use the first imputation by default. Rest of details same as above.",
"Scale all risk variables to have mean 0, sd 1 ",,,,
,,,,
Predict probability of outcome using SuperLearner,This is done only for ptids present in phase 1 datasets (ph1_placebo and ph1_vaccine) ,Placebo arm,Derive CV-predictions from only the first random seed (run) of CV-SL fit object ,
,,Vaccine arm,Derive prediction using SuperLearner model trained on placebo arm data (SL_fit),Use onlySL as TRUE
,,,,
Derive Risk Scores,Logit of the predicted outcome probability,,,
,,,,
Validate Risk Scores!,,,,
,,,,
"Info on computing platform, R version",,,,
Computing platform,x86_64-pc-linux-gnu (64-bit)    [Ubuntu 18.04.4 LTS],,,
R module loaded on rhino cluster at Hutch,ml fhR/4.0.2-foss-2019b,,,
,,,,
Version no. of R packages,,,,
COVIDcorr  data package ,2021.1.26,,,
tidyverse,1.3.0,,,
methods,4.0.2,,,
SuperLearner,2.0.26,,,
e1071,1.7.3,,,
glmnet,4.0.2,,,
argparse,2.0.1,,,
vimp,2.1.5,,,
nloptr,1.2.2.1,,,
RhpcBLASctl,0.20.137,,,
mice,3.9.0,,,
